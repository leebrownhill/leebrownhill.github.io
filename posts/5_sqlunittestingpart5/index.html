<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Unit Testing Using tSQLt: Part 5 - Lee Brownhill&#39;s Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="A blog post about SQL Unit Testing with Redgate SQL Test. Covers a tSQLt example using third party tooling">
		<meta property="og:url" content="https://leebrownhill.github.io/posts/5_sqlunittestingpart5/">
  <meta property="og:site_name" content="Lee Brownhill&#39;s Blog">
  <meta property="og:title" content="SQL Unit Testing Using tSQLt: Part 5">
  <meta property="og:description" content="A blog post about SQL Unit Testing with Redgate SQL Test. Covers a tSQLt example using third party tooling">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-08T06:00:00+00:00">
    <meta property="article:modified_time" content="2025-05-08T06:00:00+00:00">
    <meta property="article:tag" content="Sql">
    <meta property="article:tag" content="Tsql">
    <meta property="article:tag" content="Redgate">
    <meta property="article:tag" content="Unit Testing">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
		
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7983PDFMXQ"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7983PDFMXQ');
        }
      </script>

	<meta name="author" content="Lee Brownhill">
	<meta property="og:description" content="A blog post about SQL Unit Testing with Redgate SQL Test. Covers a tSQLt example using third party tooling">
	<meta property="og:image" content="https://leebrownhill.github.io/img/featured/tsqlt_logo.png">
	<meta property="og:image:type" content="img/png">

	






	

	<script src="/js/clarity.js"></script>
	<script src="/js/ads.js"></script>




	
	




</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	

	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Lee Brownhill&#39;s Blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/avatar.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Lee Brownhill&#39;s Blog</div>
					<div class="logo__tagline">A blog about SQL Server, mostly</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/talks">
				
				<span class="menu__text">talks</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about">
				
				<span class="menu__text">about</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/contact">
				
				<span class="menu__text">contact</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>


	
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Unit Testing Using tSQLt: Part 5</h1>
			
		</header>
		<div class="content post__content clearfix">
			<br>
<p>Welcome back friends!</p>
<p>During the past <a href="https://www.leebrownhill.com/tags/tsql/">four posts</a>, we have covered the fundamental concepts regarding tSQLt, look at how far we&rsquo;ve come!.
So far, everything we have done has been within SSMS using the open source framework that is tSQLt.
In this post, we&rsquo;re going to take a look at some third party tooling available, harnessing the power of tSQLt.</p>
<br>
<h3 id="redgate-sql-test">Redgate SQL Test</h3>
<p>I&rsquo;ve been a strong advocate for Redgate tools for years. They have simplified and enhanced the life of many a DBA over the years, including myself. <a href="https://www.red-gate.com/products/sql-test/">Redgate SQL Test</a> is no exception.</p>
<p>Redgate SQL Test provides a nice, integrated <a href="https://en.wikipedia.org/wiki/Graphical_user_interface">GUI</a> into SSMS for all things unit testing. Some of the key features include:</p>
<ul>
<li>Uses the tSQLt Framework</li>
<li>Comes with built-in, pre-written COP tests to check for general best practices</li>
<li>Enables one-click execution of unit tests at varying levels (database, schema, unit test)</li>
<li>Integrates with <a href="https://the.agilesql.club/2016/04/sqlcover-code-coverage-for-sql-server-t-sql/">SQL Cover</a> to provide code coverage analysis</li>
<li>Provides a graphical view of test classes and procedures</li>
</ul>
<p>Installing Redgate SQL Test is very easy to do and can be downloaded here:
<a href="https://www.red-gate.com/products/sql-test/">https://www.red-gate.com/products/sql-test/</a> <br>
A free 28 day trial is available, and I highly recommend giving it a try.</p>
<br>
<h3 id="todays-agenda">Today&rsquo;s Agenda</h3>
<p>In today&rsquo;s post, we&rsquo;ll explore key features of Redgate SQL Test and how they can enhance SQL unit testing.
You guessed it, we’re diving into a demo.</p>
<br>
<h3 id="setup---the-procedure">Setup - The Procedure</h3>
<p>Once again, we will be using the StackOverflow2010 database and we have a new procedure for today&rsquo;s demo, called dbo.GetUsersWithMostBadges.</p>
<p>An overview of what it does:</p>
<ul>
<li>Identifies the top three users by badges earned using a CTE</li>
<li>Joins the CTE to the users table to retrieve their Display Names</li>
<li>Checks the @featureflag variable and creates a temporary table when necessary</li>
</ul>
<p>Here is the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">OR</span> <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">PROCEDURE</span> [dbo].[GetUsersWithMostBadges]
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">@</span>featureflag <span style="color:#8be9fd;font-style:italic">BIT</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">BEGIN</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;<span style="color:#ff79c6">WITH</span> GetTop3 <span style="color:#ff79c6">AS</span>
</span></span><span style="display:flex;"><span>(
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">SELECT</span> TOP (<span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>		b.UserId,
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">COUNT</span>(b.Name) <span style="color:#ff79c6">AS</span> [NumberOfBadges]
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">FROM</span> dbo.Badges b
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> b.UserId
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">COUNT</span>(b.Name) <span style="color:#ff79c6">DESC</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> 
</span></span><span style="display:flex;"><span>	u.DisplayName,
</span></span><span style="display:flex;"><span>	t.NumberOfBadges
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> GetTop3 t
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INNER</span> <span style="color:#ff79c6">JOIN</span> dbo.Users u <span style="color:#ff79c6">ON</span> t.UserID <span style="color:#ff79c6">=</span> u.Id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">IF</span> <span style="color:#ff79c6">@</span>featureflag	<span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">BEGIN</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> <span style="color:#ff79c6">#</span>logging (id <span style="color:#8be9fd;font-style:italic">INT</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">END</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">END</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GO</span>
</span></span></code></pre></div><br>
<h3 id="setup---the-unit-test">Setup - The Unit Test</h3>
<p>For the accompanying unit test, we have [tests].[test GetUsersWithMostBadges]. This test verifies that the stored procedure returns the top three users based on badge count correctly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">OR</span> <span style="color:#ff79c6">ALTER</span> <span style="color:#ff79c6">PROCEDURE</span> [tests].[test GetUsersWithMostBadges]
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">BEGIN</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* ASSEMBLE STAGE */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">EXEC</span> tSQLt.FakeTable <span style="color:#f1fa8c">&#39;dbo.Badges&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Badges
</span></span><span style="display:flex;"><span>	(UserId, Name)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Nice Answer&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">8</span>,		<span style="color:#f1fa8c">&#39;Nice Answer&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Guru&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Nice Answer&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Nice Answer&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;.net&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Good Answer&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">8</span>,		<span style="color:#f1fa8c">&#39;c#&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">8</span>,		<span style="color:#f1fa8c">&#39;Stellar Question&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;.net&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;.net&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">100</span>,	<span style="color:#f1fa8c">&#39;agile&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">8</span>,		<span style="color:#f1fa8c">&#39;c#&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;.net&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">6</span>,		<span style="color:#f1fa8c">&#39;vb.net&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">6</span>,		<span style="color:#f1fa8c">&#39;visual-studio&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">6</span>,		<span style="color:#f1fa8c">&#39;vb.net&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">EXEC</span> tSQLt.FakeTable <span style="color:#f1fa8c">&#39;dbo.Users&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Users
</span></span><span style="display:flex;"><span>	(Id, DisplayName)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">10</span>,	<span style="color:#f1fa8c">&#39;Jon Skeet&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">8</span>,		<span style="color:#f1fa8c">&#39;Marc Gravell&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">6</span>,		<span style="color:#f1fa8c">&#39;JaredPar&#39;</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#bd93f9">100</span>,	<span style="color:#f1fa8c">&#39;Lee Brownhill&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> dbo.Expected
</span></span><span style="display:flex;"><span>(DisplayName NVARCHAR(<span style="color:#bd93f9">40</span>),NumberOfBadges <span style="color:#8be9fd;font-style:italic">INT</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> dbo.Actual
</span></span><span style="display:flex;"><span>(DisplayName NVARCHAR(<span style="color:#bd93f9">40</span>),NumberOfBadges <span style="color:#8be9fd;font-style:italic">INT</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Expected
</span></span><span style="display:flex;"><span>(DisplayName,NumberOfBadges)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#f1fa8c">&#39;Jon Skeet&#39;</span>,		<span style="color:#bd93f9">9</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#f1fa8c">&#39;Marc Gravell&#39;</span>,	<span style="color:#bd93f9">4</span>),
</span></span><span style="display:flex;"><span>	(<span style="color:#f1fa8c">&#39;JaredPar&#39;</span>,		<span style="color:#bd93f9">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* ACT STAGE */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Actual
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">EXEC</span> dbo.GetUsersWithMostBadges <span style="color:#ff79c6">@</span>featureflag <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* ASSERT STAGE */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">EXEC</span> tSQLt.AssertEqualsTable
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">@</span>Expected <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;dbo.Expected&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">@</span>Actual <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;dbo.Actual&#39;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">@</span>FailMsg <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;Our test failed!&#39;</span>
</span></span></code></pre></div><br>
<br>
<h3 id="using-redgate-sql-test---navigation">Using Redgate SQL Test - Navigation</h3>
<p>Now that we have both our Stored Procedure and Unit Test, we can open up Redgate SQL Test within SSMS:</p>
<img src="/posts/post_images/sqltest_0.png" alt="sql test">
<br>
<br>
<br>
<p>In my environment, this opens a window that looks like this:</p>
<img src="/posts/post_images/sqltest_1.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<ol>
<li>Our database, StackOverflow2010, contains our test classes.</li>
<li>Our schemas contain unit tests.</li>
<li>Our unit tests reside within the &rsquo;tests&rsquo; schema.</li>
</ol>
<br>
<br>
<p>The best part? We can run our tests with a single click! Even better, we can run tests at different scopes within the database.</p>
<p>To do this, simply use the right-click context menu:</p>
<img src="/posts/post_images/sqltest_2.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<p>Using this process, we can:</p>
<ol>
<li>Run all tests within the database.</li>
<li>Run all tests within the &rsquo;tests&rsquo; schema.</li>
<li>Run individual unit tests.</li>
</ol>
<br>
<br>
<h3 id="using-redgate-sql-test---running-tests">Using Redgate SQL Test - Running Tests</h3>
<p>As shown, the GUI allows us to run unit tests easily with a single click. After running the GetUsersWithMostBadges test, we see the following:</p>
<img src="/posts/post_images/sqltest_3.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<p>A green tick confirms the unit test has passed.
This process mirrors how we&rsquo;ve been executing tests previously:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">EXEC</span> tsqlt.Run <span style="color:#ff79c6">@</span>TestName <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;[tests].[test GetUsersWithMostBadges]&#39;</span>
</span></span></code></pre></div><br>
<p>The Test Output window provides additional details, including execution results and diagnostic messages:</p>
<img src="/posts/post_images/sqltest_4.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<br>
<br>
<h3 id="using-redgate-sql-test---code-coverage">Using Redgate SQL Test - Code Coverage</h3>
<p>Next, I&rsquo;ll highlight one of my favorite features in Redgate SQL Test: code coverage.
&ldquo;Code Coverage&rdquo; as a concept within unit testing is exactly what you probably think it is.</p>
<blockquote>
<p>&ldquo;How much of my code is covered by my unit test?&rdquo;</p></blockquote>
<p>This feature of SQL Test is very powerful and gives us a fantastic tool to use when we want to ensure all of our code is &lsquo;covered&rsquo; by unit tests. Let&rsquo;s run through an example.</p>
<p>Let&rsquo;s run our unit test again and navigate to the &lsquo;Code Coverage&rsquo; tab in SQL Test:</p>
<img src="/posts/post_images/sqltest_5.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<p>Before moving on, I want to highlight a couple of key points from the above screenshot, within the Code Coverage tab:</p>
<ul>
<li>Under the Object Name column header, we can see our current Stored Procedure - dbo.GetUsersWithMostBadges. All of the other entries are items that exist within this database.</li>
<li>This procedure has three statements, and two of them are covered by our unit test (remember this, dear reader)</li>
<li>This gives us 66.67% code coverage</li>
</ul>
<br>
<p>Clicking the object name link takes us to the code for the underlying procedure:</p>
<img src="/posts/post_images/sqltest_6.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<p>As shown above, the lines of code in green are covered by our associated unit test. Variable declarations and BEGIN/END keywords are intentionally excluded, as tSQLt does not consider them.
The green-highlighted lines indicate code executed as part of the associated unit test.</p>
<p>However, we can see that one line - CREATE TABLE #logging (id INT) - is not covered by the associated unit test.
This aligns with the previous screenshot, where SQL Test showed that three statements exist, but only two are covered by our test.</p>
<p>As you may have noticed, the missing &lsquo;CREATE TABLE&rsquo; statement isn&rsquo;t executed because our unit test runs the procedure with <strong>@featureflag = 0</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">/* ACT STAGE */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Actual
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">EXEC</span> dbo.GetUsersWithMostBadges <span style="color:#ff79c6">@</span>featureflag <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
</span></span></code></pre></div><p>So we need to create a new version of the unit test that calls the procedure with @featureflag = 1.</p>
<p>Let&rsquo;s create and deploy a new unit test named &rsquo;test_GetUsersWithMostBadges2&rsquo;. In the Act stage, we&rsquo;ll call the procedure with <strong>@featureflag = 1</strong>. <br>
Here&rsquo;s a snippet of the new unit test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">/* ACT STAGE */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> dbo.Actual
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">EXEC</span> dbo.GetUsersWithMostBadges <span style="color:#ff79c6">@</span>featureflag <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>
</span></span></code></pre></div><br>
<p>Once deployed, we can refresh the &rsquo;tests&rsquo; schema in SQL Test to view our new test GetUsersWithMostBadges2:</p>
<img src="/posts/post_images/sqltest_7.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<br>
<p>Let&rsquo;s execute the new unit test. Once it&rsquo;s run, within the Code Coverage tab, we can see that all three statements are now covered, achieving 100% coverage:</p>
<img src="/posts/post_images/sqltest_8.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<br>
<p>Clicking the linked stored procedure name takes us to the corresponding procedure code, showing that the previously missing coverage is now resolved:</p>
<img src="/posts/post_images/sqltest_9.png" alt="sql test" style="border: 2px solid black;">
<br>
<br>
<br>
<br>
<h3 id="recap">Recap</h3>
<p>Today, we covered Redgate SQL Test (pun totally intended). We explored a small yet powerful part of this tool’s functionality.
As with most Redgate tooling, it really makes life easier. With its intuitive GUI, we can quickly run tests, assess coverage, and identify gaps where tests are missing.</p>
<p>That brings us to the end of this series, for now. I do hope you have enjoyed this series as much as I have had creating it. It&rsquo;s been great fun getting back into Unit Testing within SQL Server.</p>
<p>See you in the next post!
<br>
<br>
<br></p>
<hr>
<p>If you’ve found this post helpful or would just like to support the work I do here, consider buying me a coffee.</p>
<p><a href="https://www.buymeacoffee.com/leebrownhill" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/arial-green.png" alt="Buy Me A Coffee" style="height: 55px !important;width: 217px !important;" ></a></p>
<br>
<br>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/sql/" rel="tag">sql</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/tsql/" rel="tag">tsql</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/redgate/" rel="tag">redgate</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/unit-testing/" rel="tag">unit testing</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Lee Brownhill avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">Author: Lee Brownhill</span>
	</div>
	<div class="authorbox__description">
		Lee Brownhill is a SQL Server Professional. He enjoys making SQL Server go faster
	</div>
</div>



			</div>
			
		</div>
		<style>
  .footer__container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    text-align: left;
    font-size: 0.75rem;  
  }

  @media (max-width: 600px) {
    .footer__container {
      font-size: 0.60rem;  
    }
  }

  .footer__copyright {
    flex: 1;
  }

  .footer__privacy {
    text-align: right;
  }
</style>

<footer class="footer">
  <div class="container footer__container">
    <div class="footer__copyright">
      &copy; 2025 Lee Brownhill.
      <span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
    </div>
    <div class="footer__privacy">
      <a href="/privacy-policy" rel="noopener noreferrer">Privacy Policy</a>
    </div>
  </div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>